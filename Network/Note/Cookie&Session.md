# Cookie & Session

## :bookmark_tabs: 목차

[:arrow_up: **Network**](../README.md)

1. ### Cookie & Session
   - [:page_facing_up: cookie와 session을 사용하는 이유](#cookie와-session을-사용하는-이유)
   - [:page_facing_up: Cookie](#cookie)
   - [:page_facing_up: Session](#session)
   - [:page_facing_up: 쿠키와 세션의 차이점](#cookie와-session의-차이점)


## Cookie와 Session을 사용하는 이유

connectionless<sup>1</sup> <sub>비연결성</sub>, stateless<sup>2</sup> <sub>무상태성</sub>한 특성을 가지는 HTTP protocol의 특성을 보완하기 위해 사용

<sup>1</sup> connectionless <sub>비연결성</sub> : 클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊어 버리는 특징

<sup>2</sup> stateless <sub>무상태성</sub> : 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않는 특성

- HTTP protocol의 두 특성 때문에 서버는 클라이언트가 누구인지 매번 확인을 해야함.
- 이러한 특성을 보완하기 위해 쿠키와 세션을 사용

</br>

## Cookie

> 웹 사이트에 접속할 때 생성되는 정보를 담은 임시 파일

- 클라이언트 로컬에 저장되어 필요시 정보를 참조하거나 재사용할 수 있음.
- (key, value) 형태로 저장되는 String 형식의 데이터
- 브라우저마다 저장할 수 있는 최대 쿠키 개수는 다름
- 하나의 쿠키값은 4KB까지 저장
- 사용자가 따로 요청하지 않아도 브라우저가 Request시에 Request Header에 넣어 서버로 전송
- 데이터가 서버가 아닌 사용자의 PC에 저장되기 때문에, 임의로 고치거나 지우고 가로채기 쉬워 보안이 취약하다는 단점이 있음.
    - 따라서 쿠키에는 민감하거나 중요한 정보를 담는 것은 위험

### 쿠키의 구성 요소

- 이름 : 쿠키를 구별하는 식별자
- 값 : 쿠키에 저장되는 값
- 유효시간 : 쿠키의 유지시간
- 도메인 : 쿠키를 전송할 도메인, 브라우저가 웹서버로 쿠키를 전송할 때 해당도메인과 일치하는 요청에 대해서만 쿠키를 전송
- 경로 : 쿠키를 전송할 요청 경로, 브라우저가 웹서버로 쿠키를 전송할 때 해당 경로와 일치하는 쿠키만 전송

### 쿠키의 동작 방식

1. 클라이언트가 서버에 요청
2. 서버는 상태를 유지하고 싶은 값을 담은 쿠키 생성
3. HTTP Header에 set-cookie 옵션을 통해 쿠키를 포함하여 응답
4. 클라이언트는 해당 쿠키를 로컬에 저장
5. 이후 다시 서버에 HTTP Request를 보낼 때 클라이언트는 로컬에서 쿠키를 꺼내 HTTP Header에 쿠키를 담아서 전송
6. 동일 사이트 재방문 시 클라이언트의 PC에 쿠키가 있는 경우, 요청 페이지와 함께 쿠키 전송

### 쿠키 활용 예시
- 자동 로그인, 로그인 시 아이디 자동 입력
- 쇼핑몰의 장바구니 기능
- 팝업 창에서 "오늘 더 이상 이 창을 보지 않음"과 같은 사용자의 편의를 위한 기능


## Session

> 일정 시간동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지시키는 기술

- 사용자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료할 때까지 인증상태를 유지
- 방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고 그것을 세션이라고 함.
- 쿠키를 기반으로 하고 있지만 세션은 쿠키와 달리 **서버측에서 사용자 정보를 관리**
- 세션도 쿠키를 사용하여 값을 주고받으며 클라이언트의 상태 정보를 유지
    - 즉, 상태 정보를 유지하는 수단은 쿠키
- 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지
    - `세션 ID` : 클라이언트가 Request를 보내면 해당 서버의 엔진이 클라이언트에게 부여하는 유일한 ID
- 사용자에 대한 정보를 서버에 두기 때문에 보안 면에서 쿠키보다 우수
- 그러나 사용자가 많아질수록 서버 메모리를 많이 차지하게 되는 단점이 존재
    - 이러한 문제들을 보완하기 위해 토큰 기반의 인증 방식인 JWT를 사용하기도 함.
- 동시접속자가 많은 웹 사이트의 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 될 수 있음.

### 세션의 동작 방식

1. 웹 브라우저(클라이언트)가 서버에 요청
2. 서버는 해당 클라이언트에 유일한 ID(Session ID)를 부여
3. 서버가 응답할 때 HTTP Header에 Session ID를 포함하여 전송
    - 쿠키에 JESSIONID라는 이름으로 저장
4. 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장하고 가지고 있음.
5. 클라리언트는 서버에 요청할 때, 세션 ID가 담겨 있는 쿠키를 HTTP Header에 넣어 같이 서버에 전송
6. 서버는 세션 ID를 확인한 후, 세션 ID로 세션에 있는 클라언트 정보를 가져와서 사용
7. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답

### 세션 활용 예시
- 로그인 유지 : 화면을 이동해도 로그아웃 하기 전까지는 로그인이 유지됨.

### 세션보다 쿠키를 사용하는 이유
세션이 쿠키보다 보안도가 높지만 서버에 저장되기 때문에, 사용자가 많을 경우 서버의 메모리가 감당할 수 없어지고 속도가 느려질 수 있기 때문에 쿠키가 더 유리할 수도 있음.


</br>

## Cookie와 Session의 차이점
| | Cookie | Session |
| --- | --- | --- |
| 저장 위치 | 클라이언트 | 웹 서버 |
| 저장 형식 | text | Object |
| 만료 기간(라이프 사이클) | 쿠키 저장 시 설정 </br> 브라우저가 종료되어도 기간이 남아있다면 계속 남아있음. | 만료 기간을 정할 수는 있지만 브라우저 종료 시 그에 상관없이 삭제 | 
| 용량 제한 | 하나의 쿠키 당 4kb | 서버가 허용하는 한 용량제한 없음.|
| 속도 | 세션보다는 빠름. </br> 쿠키에 정보가 저장되어 있어서 헤더를 참조하기만 하면 됨. | 쿠키보다는 느림. </br> 제공받은 세션 ID를 이용하여 서버에서 다시 데이터를 참조해야 하기 때문 |
| 보안 | 세션보다 위험 | 쿠키보다는 안전 |





</br>

---

- 참고

    [쿠키와 세션 개념](https://interconnection.tistory.com/74)

    [HTTP Cookie(쿠키)에 대해 알아 보자.](https://hjjungdev.tistory.com/185)

    [[Code.presso] 쿠키와 세션 개념과 활용 예시를 알아보자.](https://velog.io/@sorzzzzy/Code.presso-%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98%EA%B0%9C%EB%85%90%EA%B3%BC-%ED%99%9C%EC%9A%A9-%EC%98%88%EC%8B%9C%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90)

    [쿠키(Cookie), 세션(Session) 특징 및 차이](https://hahahoho5915.tistory.com/32)

    [쿠키(Cookie)와 세션(Session)](https://doooyeon.github.io/2018/09/10/cookie-and-session.html)